# Phase 5: Agents & Function Calling - å­¦ä¹ æ€»ç»“

## ğŸ“š æœ¬ç« æ¦‚è¿°

**Agentsï¼ˆæ™ºèƒ½ä½“ï¼‰**å’Œ **Function Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰**æ˜¯ AI åº”ç”¨çš„é©å‘½æ€§çªç ´ï¼Œè®© AI ä»"è¢«åŠ¨å›ç­”"è¿›åŒ–ä¸º"ä¸»åŠ¨è¡ŒåŠ¨"ã€‚

**æ ¸å¿ƒçªç ´ï¼š**

> AI ä¸å†åªæ˜¯å›ç­”é—®é¢˜ï¼Œè€Œæ˜¯èƒ½å¤Ÿè°ƒç”¨å·¥å…·ã€è®¿é—®æ•°æ®ã€æ‰§è¡Œæ“ä½œï¼Œæˆä¸ºçœŸæ­£çš„æ™ºèƒ½åŠ©æ‰‹ã€‚

---

## ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹å›é¡¾

### 1. ä»€ä¹ˆæ˜¯ AI Agentï¼Ÿ

**ä¼ ç»Ÿ LLM vs AI Agentï¼š**

| ä¼ ç»Ÿ LLM         | AI Agent         |
| ---------------- | ---------------- |
| åªèƒ½å¯¹è¯         | èƒ½å¤Ÿè¡ŒåŠ¨         |
| "æˆ‘æ— æ³•æŸ¥è¯¢å¤©æ°”" | è‡ªåŠ¨è°ƒç”¨å¤©æ°” API |
| è¢«åŠ¨å›ç­”         | ä¸»åŠ¨æ‰§è¡Œ         |
| é™æ€çŸ¥è¯†         | åŠ¨æ€æ•°æ®è®¿é—®     |

**ç¤ºä¾‹å¯¹æ¯”ï¼š**

```
âŒ ä¼ ç»ŸLLM:
ç”¨æˆ·: "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
AI: "æŠ±æ­‰ï¼Œæˆ‘æ— æ³•è·å–å®æ—¶å¤©æ°”ä¿¡æ¯..."

âœ… AI Agent:
ç”¨æˆ·: "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
AI: [è°ƒç”¨ get_weather("åŒ—äº¬")]
AI: "åŒ—äº¬ä»Šå¤©æ™´å¤©ï¼Œæ¸©åº¦15åº¦ï¼Œç©ºæ°”è´¨é‡è‰¯å¥½ã€‚"
```

---

### 2. Function Calling å·¥ä½œåŸç†

**å®Œæ•´æµç¨‹ï¼ˆ7 æ­¥ï¼‰ï¼š**

```mermaid
graph TD
    A[1. å®šä¹‰å·¥å…·] --> B[2. ç”¨æˆ·æé—®]
    B --> C[3. AIåˆ¤æ–­æ˜¯å¦éœ€è¦å·¥å…·]
    C --> D[4. AIç”Ÿæˆå‡½æ•°è°ƒç”¨è¯·æ±‚]
    D --> E[5. ç¨‹åºæ‰§è¡Œå®é™…å‡½æ•°]
    E --> F[6. å°†ç»“æœè¿”å›ç»™AI]
    F --> G[7. AIç”Ÿæˆæœ€ç»ˆå›ç­”]
```

**å…³é”®æ­¥éª¤è¯¦è§£ï¼š**

**æ­¥éª¤ 1ï¼šå®šä¹‰å·¥å…·**

```typescript
const tools = [
  {
    functionDeclarations: [
      {
        name: "get_weather",
        description: "è·å–åŸå¸‚å¤©æ°”ä¿¡æ¯", // â† AIæ ¹æ®è¿™ä¸ªå†³å®šä½•æ—¶è°ƒç”¨
        parameters: {
          type: SchemaType.OBJECT,
          properties: {
            city: {
              type: SchemaType.STRING,
              description: "åŸå¸‚åç§°", // â† å¸®åŠ©AIæå–å‚æ•°
            },
          },
        },
      },
    ],
  },
];
```

**æ­¥éª¤ 3-4ï¼šAI å†³ç­–å¹¶ç”Ÿæˆè°ƒç”¨**

```json
// AIåˆ†æï¼š"è¿™éœ€è¦å®æ—¶å¤©æ°”æ•°æ®ï¼Œæˆ‘åº”è¯¥è°ƒç”¨ get_weather"
{
  "name": "get_weather",
  "arguments": { "city": "åŒ—äº¬" }
}
```

**æ­¥éª¤ 5-6ï¼šæ‰§è¡Œå¹¶è¿”å›**

```typescript
const result = getWeather("åŒ—äº¬");
// { temperature: 20, condition: "æ™´å¤©" }
```

---

### 3. Function Calling vs ä¼ ç»Ÿç¼–ç¨‹

| å¯¹æ¯”ç»´åº¦     | ä¼ ç»Ÿç¼–ç¨‹                      | Function Calling      |
| ------------ | ----------------------------- | --------------------- |
| **å†³ç­–è€…**   | ç¨‹åºå‘˜å†™æ­»é€»è¾‘                | AI æ™ºèƒ½å†³ç­–           |
| **å‚æ•°æå–** | å›ºå®šçš„ if-else                | AI ç†è§£è‡ªç„¶è¯­è¨€       |
| **çµæ´»æ€§**   | éœ€è¦æšä¸¾æ‰€æœ‰æƒ…å†µ              | ç†è§£å„ç§è¡¨è¾¾          |
| **ç¤ºä¾‹**     | `if (input.contains("å¤©æ°”"))` | AI ç†è§£"å¸éƒ½ä»Šå¤©å†·å—" |

**ä»£ç å¯¹æ¯”ï¼š**

**ä¼ ç»Ÿæ–¹å¼ï¼š**

```typescript
if (input.includes("å¤©æ°”") && input.includes("åŒ—äº¬")) {
  getWeather("åŒ—äº¬");
} else if (input.includes("å¤©æ°”") && input.includes("ä¸Šæµ·")) {
  getWeather("ä¸Šæµ·");
}
// éœ€è¦å¤„ç†æ— æ•°ç§ç»„åˆ...ğŸ˜«
```

**Function Callingï¼š**

```typescript
// AIè‡ªåŠ¨ç†è§£å¹¶è°ƒç”¨ï¼âœ¨
"åŒ—äº¬å¤©æ°”" â†’ get_weather("åŒ—äº¬")
"å¸éƒ½ä»Šå¤©å†·å—" â†’ get_weather("åŒ—äº¬")
"BJçš„æ¸©åº¦" â†’ get_weather("åŒ—äº¬")
```

---

### 4. å·¥å…·å®šä¹‰æœ€ä½³å®è·µ

**JSON Schema æ ¼å¼ï¼š**

```typescript
{
  name: 'calculator',              // å‡½æ•°åï¼ˆå¿…é¡»ï¼‰
  description: 'æ‰§è¡Œæ•°å­¦è®¡ç®—',     // ä½•æ—¶ä½¿ç”¨ï¼ˆå…³é”®ï¼ï¼‰
  parameters: {
    type: SchemaType.OBJECT,
    properties: {
      expression: {
        type: SchemaType.STRING,
        description: 'æ•°å­¦è¡¨è¾¾å¼ï¼Œå¦‚"2+3"'  // å¸®åŠ©AIç†è§£
      }
    },
    required: ['expression']       // å¿…éœ€å‚æ•°
  }
}
```

**å…³é”®åŸåˆ™ï¼š**

1. **description æå…¶é‡è¦** - AI é å®ƒå†³å®šä½•æ—¶è°ƒç”¨
2. **å‚æ•°æè¿°è¦æ¸…æ™°** - å¸®åŠ© AI æ­£ç¡®æå–
3. **é¿å…å¤æ‚æšä¸¾** - Gemini å¯¹ NUMBER æšä¸¾æœ‰é™åˆ¶

---

## ğŸ’» ä»£ç ç¤ºä¾‹å›é¡¾

### ç¤ºä¾‹ 1ï¼šåŸºç¡€ Function Calling

**æ–‡ä»¶ï¼š** [src/08-function-calling-basics.ts](file:///Users/perlou/Desktop/personal/go-blog/ai-learning-ts/src/08-function-calling-basics.ts)

**æ¼”ç¤ºå†…å®¹ï¼š**

- å®šä¹‰ä¸¤ä¸ªå·¥å…·ï¼šå¤©æ°”æŸ¥è¯¢ã€è®¡ç®—å™¨
- AI è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å·¥å…·
- å¤„ç†å·¥å…·è°ƒç”¨å’Œå“åº”

**å…³é”®ä»£ç ï¼š**

```typescript
// æ­£ç¡®è®¿é—® function calls
const candidate = response.candidates?.[0];
const parts = candidate?.content?.parts || [];
const functionCallPart = parts.find((part) => part.functionCall);

if (functionCallPart?.functionCall) {
  const fc = functionCallPart.functionCall;
  // æ‰§è¡Œå‡½æ•°...
}
```

**è¿è¡Œï¼š**

```bash
npx tsx src/08-function-calling-basics.ts
```

---

### ç¤ºä¾‹ 2ï¼šå®ç”¨å¤©æ°”åŠ©æ‰‹

**æ–‡ä»¶ï¼š** [src/09-weather-agent.ts](file:///Users/perlou/Desktop/personal/go-blog/ai-learning-ts/src/09-weather-agent.ts)

**æ¼”ç¤ºå†…å®¹ï¼š**

- å¤šä¸ªå·¥å…·ï¼šå½“å‰å¤©æ°”ã€å¤©æ°”é¢„æŠ¥
- å¤šè½®å¯¹è¯æ”¯æŒ
- åŸºäºä¸Šä¸‹æ–‡çš„æ™ºèƒ½æ¨ç†

**ç‰¹æ€§ï¼š**

```
ç”¨æˆ·: "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
AI: [è°ƒç”¨ get_current_weather("åŒ—äº¬")]

ç”¨æˆ·: "æ¸©åº¦é€‚åˆç©¿ä»€ä¹ˆï¼Ÿ"  â† åŸºäºä¹‹å‰çš„å¤©æ°”ä¿¡æ¯
AI: "15åº¦å»ºè®®ç©¿é•¿è¢–..."
```

**è¿è¡Œï¼š**

```bash
npx tsx src/09-weather-agent.ts
```

---

### ç¤ºä¾‹ 3ï¼šå¤šå·¥å…·æ™ºèƒ½åŠ©æ‰‹

**æ–‡ä»¶ï¼š** [src/10-multi-tool-agent.ts](file:///Users/perlou/Desktop/personal/go-blog/ai-learning-ts/src/10-multi-tool-agent.ts)

**å¯ç”¨å·¥å…·ï¼š**

- ğŸ§® è®¡ç®—å™¨
- ğŸ• æ—¶é—´æŸ¥è¯¢ï¼ˆå¤šæ—¶åŒºï¼‰
- ğŸ”„ å•ä½è½¬æ¢
- ğŸ” çŸ¥è¯†æœç´¢

**å¤æ‚ä»»åŠ¡ç¤ºä¾‹ï¼š**

```
ç”¨æˆ·: "å¦‚æœæˆ‘åœ¨ä¸Šæµ·ä¹°äº†100ç±³å¸ƒæ–™ï¼Œé‡50å…¬æ–¤ï¼Œè¿åˆ°çº½çº¦ã€‚
     è¯·å‘Šè¯‰æˆ‘ï¼š1) å¸ƒæ–™æ˜¯å¤šå°‘è‹±å°ºï¼Ÿ2) é‡é‡æ˜¯å¤šå°‘ç£…ï¼Ÿ3) ç°åœ¨çº½çº¦å‡ ç‚¹ï¼Ÿ"

AI è‡ªåŠ¨è§„åˆ’:
1. convert_units(100, "meter", "feet")
2. convert_units(50, "kg", "lb")
3. get_current_time("America/New_York")
4. ç»¼åˆå›ç­”
```

**è¿è¡Œï¼š**

```bash
npx tsx src/10-multi-tool-agent.ts
```

---

### è°ƒè¯•ç¤ºä¾‹ï¼šFunction Calling æµ‹è¯•

**æ–‡ä»¶ï¼š** [src/test-function-calling.ts](file:///Users/perlou/Desktop/personal/go-blog/ai-learning-ts/src/test-function-calling.ts)

**ç”¨é€”ï¼š**

- éªŒè¯ Function Calling æ˜¯å¦æ­£å¸¸å·¥ä½œ
- æŸ¥çœ‹å®Œæ•´çš„è°ƒç”¨æµç¨‹
- è°ƒè¯•å·¥å…·å®šä¹‰é—®é¢˜

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
âœ… Function Calling è¢«è§¦å‘ï¼
å‡½æ•°å: get_weather
å‚æ•°: { "city": "åŒ—äº¬" }
ğŸ”§ æ‰§è¡Œå‡½æ•°ï¼Œè¿”å›: { "temperature": 15, "condition": "æ™´å¤©" }
ğŸ¤– AI æœ€ç»ˆå›å¤: åŒ—äº¬ä»Šå¤©æ™´å¤©ï¼Œ15åº¦ã€‚
```

---

## ğŸ”§ å®é™…åº”ç”¨åœºæ™¯

### 1. æ•°æ®æŸ¥è¯¢åŠ©æ‰‹

```typescript
// æŸ¥è¯¢æ•°æ®åº“ã€ç”ŸæˆæŠ¥è¡¨
tools = [
  { name: 'query_database', ... },
  { name: 'generate_chart', ... }
]

ç”¨æˆ·: "æ˜¾ç¤ºä¸Šä¸ªæœˆé”€å”®é¢å‰10çš„äº§å“"
AI: [æŸ¥è¯¢æ•°æ®åº“] â†’ [ç”Ÿæˆå›¾è¡¨] â†’ å›å¤
```

### 2. å®¢æœæœºå™¨äºº

```typescript
tools = [
  { name: 'æŸ¥è¯¢è®¢å•', ... },
  { name: 'ç”³è¯·é€€æ¬¾', ... },
  { name: 'ç‰©æµè·Ÿè¸ª', ... }
]

ç”¨æˆ·: "æˆ‘çš„è®¢å•ä»€ä¹ˆæ—¶å€™å‘è´§ï¼Ÿ"
AI: [æŸ¥è¯¢è®¢å•] â†’ "æ‚¨çš„è®¢å•å·²äºä»Šå¤©å‘è´§..."
```

### 3. ä»£ç åŠ©æ‰‹

```typescript
tools = [
  { name: 'æ‰§è¡Œä»£ç ', ... },
  { name: 'æœç´¢æ–‡æ¡£', ... },
  { name: 'ç”Ÿæˆæµ‹è¯•', ... }
]
```

### 4. è‡ªåŠ¨åŒ–å·¥ä½œæµ

```typescript
tools = [
  { name: 'å‘é€é‚®ä»¶', ... },
  { name: 'åˆ›å»ºæ—¥ç¨‹', ... },
  { name: 'ç”ŸæˆæŠ¥å‘Š', ... }
]
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. AI ä¸ä¿è¯ 100%æ­£ç¡®

- å¯èƒ½é€‰é”™å·¥å…·
- å¯èƒ½æå–é”™å‚æ•°
- **å¿…é¡»éªŒè¯å…³é”®æ“ä½œ**

### 2. å®‰å…¨æ€§è€ƒè™‘

```typescript
// âŒ å±é™©ï¼šç›´æ¥æš´éœ²åˆ é™¤åŠŸèƒ½
{ name: 'delete_all_data', ... }

// âœ… å®‰å…¨ï¼šæ·»åŠ ç¡®è®¤å’Œæƒé™
async function deleteData(confirm: boolean, adminKey: string) {
  if (!confirm || adminKey !== SECRET) return;
  // æ‰§è¡Œåˆ é™¤...
}
```

### 3. æˆæœ¬æ§åˆ¶

- æ¯æ¬¡å·¥å…·è°ƒç”¨ = é¢å¤–çš„ API è¯·æ±‚
- å¤æ‚ä»»åŠ¡å¯èƒ½éœ€è¦å¤šè½®å¯¹è¯
- ç›‘æ§å’Œé™åˆ¶è°ƒç”¨æ¬¡æ•°

### 4. é”™è¯¯å¤„ç†

```typescript
function executeFunction(fc: any) {
  try {
    const result = actualFunction(fc.args);
    return { success: true, data: result };
  } catch (error) {
    return { success: false, error: error.message };
  }
}
```

---

## ğŸ“ å…³é”®æ”¶è·æ€»ç»“

### Function Calling çš„ä»·å€¼

**æŠ€æœ¯ä»·å€¼ï¼š**

- ğŸ”— è¿æ¥ AI ä¸çœŸå®ä¸–ç•Œæ•°æ®
- ğŸ¤– è®© AI å…·å¤‡æ‰§è¡Œèƒ½åŠ›
- ğŸ§  æ™ºèƒ½æ„å›¾ç†è§£å’Œä»»åŠ¡è§„åˆ’

**å•†ä¸šä»·å€¼ï¼š**

- ğŸ’¼ è‡ªåŠ¨åŒ–å®¢æœå’Œæ”¯æŒ
- ğŸ“Š æ™ºèƒ½æ•°æ®åˆ†æ
- âš¡ æé«˜å·¥ä½œæ•ˆç‡

### ä»å¯¹è¯åˆ°è¡ŒåŠ¨çš„æ¼”è¿›

```
Phase 1-2: ç†è§£ AI å’Œæç¤ºè¯
         â†“
Phase 3-4: æ„å»ºå¯¹è¯åº”ç”¨
         â†“
Phase 5: AI æˆä¸ºè¡ŒåŠ¨è€…  â† æˆ‘ä»¬åœ¨è¿™é‡Œï¼
         â†“
æœªæ¥: è‡ªä¸» AI Agent
```

---

## ğŸ“Š æ”¯æŒ Function Calling çš„æ¨¡å‹

| æ¨¡å‹             | æ”¯æŒæƒ…å†µ    | API å…³é”®å­—             |
| ---------------- | ----------- | ---------------------- |
| **Gemini 2.0**   | âœ… å®Œå…¨æ”¯æŒ | `functionDeclarations` |
| **GPT-4/GPT-4o** | âœ… å®Œå…¨æ”¯æŒ | `tools`                |
| **Claude 3.5**   | âœ… Tool Use | `tools`                |
| **Llama 3.1+**   | âœ… æ”¯æŒ     | `tools`                |

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **å®è·µé¡¹ç›®**

   - æ„å»ºè‡ªå·±çš„å·¥å…·é›†
   - é›†æˆçœŸå® APIï¼ˆå¤©æ°”ã€è‚¡ç¥¨ç­‰ï¼‰
   - åˆ›å»ºå®ç”¨çš„ Agent

2. **æ·±å…¥å­¦ä¹ **

   - LangChain.js æ¡†æ¶
   - å‘é‡æ•°æ®åº“é›†æˆ
   - æœ¬åœ° LLMï¼ˆOllamaï¼‰

3. **æ¢ç´¢é«˜çº§è¯é¢˜**
   - Multi-Agent ç³»ç»Ÿ
   - è‡ªä¸»è§„åˆ’å’Œæ‰§è¡Œ
   - Agent è¯„ä¼°å’Œä¼˜åŒ–

---

**æ­å–œå®Œæˆ Phase 5ï¼ğŸ‰**  
ä½ ç°åœ¨å·²ç»æŒæ¡äº† AI åº”ç”¨å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®é™…åº”ç”¨ï¼Œå¯ä»¥æ„å»ºçœŸæ­£æœ‰ç”¨çš„æ™ºèƒ½åŠ©æ‰‹äº†ï¼
